var Ot=Object.defineProperty;var xt=(a,e,t)=>e in a?Ot(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var W=(a,e,t)=>(xt(a,typeof e!="symbol"?e+"":e,t),t),dt=(a,e,t)=>{if(!e.has(a))throw TypeError("Cannot "+t)};var s=(a,e,t)=>(dt(a,e,"read from private field"),t?t.call(a):e.get(a)),c=(a,e,t)=>{if(e.has(a))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(a):e.set(a,t)},h=(a,e,t,i)=>(dt(a,e,"write to private field"),i?i.call(a,t):e.set(a,t),t);var d=(a,e,t)=>(dt(a,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerpolicy&&(n.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?n.credentials="include":o.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();let O=(a=21)=>crypto.getRandomValues(new Uint8Array(a)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");const E={CONNECT:"CONNECT",RECEIVED:"RECEIVED",UPDATE:"UPDATE",CLOSED:"CLOSED",OPENED:"OPENED"};var q,y;class Pt{constructor(e="state"){c(this,q,"state");c(this,y,null);h(this,q,e),h(this,y,JSON.parse(localStorage.getItem(s(this,q))))}get({key:e,fn:t}){if(s(this,y)===null)return null;const i=s(this,y)[e]||null;return t?t(s(this,y),i):i}set({key:e,value:t}){let i=s(this,y);return i===null?i={[e]:t}:i[e]=t,h(this,y,i),localStorage.setItem(s(this,q),JSON.stringify(s(this,y))),s(this,y)}}q=new WeakMap,y=new WeakMap;class _t{constructor(){W(this,"events",{})}emit(e,...t){const i=this.events[e]||[];for(let o=0,n=i.length;o<n;o++){const r=i[o];r(...t)}}on(e,t){return this.events[e]?this.events[e].push(t):this.events[e]=[t],()=>{var i;this.events[e]=(i=this.events[e])==null?void 0:i.filter(o=>t!==o)}}}var T,v,k,I,$,_,D,F,ht,j,ut,X,Z,tt,yt;class Et{constructor(e,t,i={}){c(this,F);c(this,j);c(this,tt);c(this,T,"active");c(this,v,{top:10,left:-10,right:0,bottom:0});c(this,k,[]);c(this,I,{closed:()=>{},opened:()=>{}});c(this,$,null);c(this,_,null);c(this,D,{});c(this,X,()=>{s(this,F,ht)&&d(this,j,ut).call(this)});c(this,Z,e=>{if(!s(this,F,ht)){s(this,k).includes(e.target.closest(".trigger"))&&this.open();return}(e.target.closest(".popup")!==s(this,_)||!e.target.closest(".popup")||s(this,k).includes(e.target.closest(".trigger")))&&this.close(e.target)});var r;Array.isArray(e)?h(this,k,e.map(l=>document.querySelector(l))):h(this,k,[document.querySelector(e)]),h(this,_,document.querySelector(t));const{floatElement:o=null,...n}=i;h(this,$,(r=document.querySelector(o))!=null?r:s(this,k)[0]),n.offset&&Object.assign(s(this,v),n.offset),n.hooks&&Object.assign(s(this,I),n.hooks),d(this,tt,yt).call(this)}open(){d(this,j,ut).call(this),s(this,_).classList.add(s(this,T)),s(this,I).opened()}close(e){s(this,_).classList.remove(s(this,T)),s(this,_).style={},h(this,D,{}),s(this,I).closed(e)}}T=new WeakMap,v=new WeakMap,k=new WeakMap,I=new WeakMap,$=new WeakMap,_=new WeakMap,D=new WeakMap,F=new WeakSet,ht=function(){return s(this,_).classList.contains(s(this,T))},j=new WeakSet,ut=function(){const e=s(this,$).getBoundingClientRect(),t=document.body.clientWidth,i=s(this,_).clientWidth,o=e.top+s(this,v).top,n=t>=e.right+s(this,v).left+i?e.right+s(this,v).left:e.left-s(this,_).clientWidth+s(this,v).right;Object.assign(s(this,D),{top:o,left:n});for(const r in s(this,D))s(this,_).style[r]=`${s(this,D)[r]}px`},X=new WeakMap,Z=new WeakMap,tt=new WeakSet,yt=function(){document.addEventListener("click",s(this,Z)),window.addEventListener("resize",s(this,X))};function b(a,{attribute:e,value:t}){t!==!1?a.setAttribute(e,t):a.removeAttribute(e)}function H(a,{className:e,predicat:t}){t?a.classList.add(e):a.classList.remove(e)}function pt({container:a,elements:e,sortFn:t,eachFn:i}={}){Array.from(e).sort((o,n)=>t?t(o,n):Number(o.dataset.position)-Number(n.dataset.position)).forEach((o,n)=>{a.appendChild(o),i&&i(o,n)})}class m{constructor(e,t={}){W(this,"element",null);this.element=document.createElement(e),t.data&&(this.element._data=t.data);const{attrs:i={},on:o={},classNames:n=[],children:r=[]}=t;for(const l of n)if(typeof l=="string")this.element.classList.add(l);else for(const p in l)H(this.element,{className:p,predicat:l[p]});for(const l in i)i[l]!==!1&&b(this.element,{attribute:l,value:i[l]});for(const l of r)this.element.appendChild(l.element||l);for(const l in o)this.element.addEventListener(l,t.on[l])}}function ft(a){return`
    background-image: url(https://logo.clearbit.com/${a}),
    url(${new URL("/kagi-try/assets/favicon-fallback.bea50745.svg",self.location).href})`}var R,A,B,et,Ct,L,x,st,Nt;class qt extends Et{constructor(t){super(".nav__btn--more-btn",".search-menu",{hooks:{opened:()=>{d(this,et,Ct).call(this)}}});c(this,et);c(this,L);c(this,st);c(this,R,[]);c(this,A,null);c(this,B,null);h(this,B,document.querySelector(".search-menu")),t.on(E.RECEIVED,i=>{h(this,R,i),h(this,A,new Map(s(this,R).map(o=>[o.id,o])))})}open(){super.open()}close(){super.close()}}R=new WeakMap,A=new WeakMap,B=new WeakMap,et=new WeakSet,Ct=function(){s(this,R).filter(t=>t.selected&&s(this,B).querySelector(`li[data-id="${t.id}"]`)===null).forEach(t=>{s(this,L,x).appendChild(d(this,st,Nt).call(this,t))}),pt({container:s(this,L,x),elements:Array.from(s(this,L,x).children),sortFn:(t,i)=>{const o=t.dataset.id,n=i.dataset.id,r=s(this,A).get(o),l=s(this,A).get(n);return r&&b(t,{attribute:"data-position",value:r.position}),l&&b(i,{attribute:"data-position",value:l.position}),Number(t.dataset.position)-Number(i.dataset.position)},eachFn:t=>{const i=s(this,A).get(t.dataset.id);i||s(this,L,x).removeChild(t),i&&!i.selected&&s(this,L,x).removeChild(t)}})},L=new WeakSet,x=function(){return s(this,B).querySelector(".popup__section-list")},st=new WeakSet,Nt=function(t){return new m("li",{classNames:["popup__section-item"],attrs:{"data-id":t.id,"data-position":t.position},children:[new m("a",{classNames:["popup__action"],attrs:{href:t.href,target:"_blank"},children:[new m("span",{classNames:["popup__icon",`popup__icon--${t.icon}`],attrs:{style:ft(t.href)}}),new m("span",{children:[document.createTextNode(t.label)]})]})]}).element};function Tt(a,e){let t,i;Array.from(a.children).forEach(r=>{r.hasAttribute("draggable")&&r.classList.add("draggable")});function o(r){if(r.preventDefault(),r.stopPropagation(),r.dataTransfer.dropEffect="move",!r.target)return;const l=r.target,p=l.closest(".draggable");if(l&&l!==t&&p!==null){const N=l.getBoundingClientRect(),At=(r.clientY-N.top)/(N.bottom-N.top)>.5;if(Math.floor(a.getBoundingClientRect().bottom)===r.clientY){a.appendChild(t);return}a.insertBefore(t,At&&p.nextSibling||p)}}function n(r){r.preventDefault(),r.stopPropagation(),t.classList.remove("ghost"),a.removeEventListener("dragover",o,!1),a.removeEventListener("dragend",n,!1),i!==t.nextSibling&&e(t)}a.addEventListener("dragstart",r=>{r.stopPropagation(),t=r.target,i=t.nextSibling,r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("Text",t),a.addEventListener("dragover",o,!1),a.addEventListener("dragend",n,!1),setTimeout(()=>{t.classList.add("ghost")},0)},!1)}var C,S,z,it,vt,M,Q,Y,mt;class It{constructor(e,{onSubmit:t}){c(this,it);c(this,M);c(this,Y);c(this,C,null);c(this,S,!1);c(this,z,{});h(this,C,document.querySelector(e)),s(this,C).addEventListener("submit",i=>{i.preventDefault(),t(Object.assign(s(this,z),d(this,it,vt).call(this)),s(this,S)),h(this,S,!1),d(this,M,Q).call(this),s(this,C).reset(),this.clear()})}fillForm(e){d(this,Y,mt).call(this,e),h(this,S,!0),d(this,M,Q).call(this)}clear(){h(this,S,!1),d(this,M,Q).call(this),d(this,Y,mt).call(this,{}),s(this,C).reset()}}C=new WeakMap,S=new WeakMap,z=new WeakMap,it=new WeakSet,vt=function(){const e={};return Array.from(s(this,C).elements).forEach(t=>{t.name&&(e[t.name]=t.value)}),e},M=new WeakSet,Q=function(){s(this,C).submit.textContent=s(this,S)?"Save":"Add"},Y=new WeakSet,mt=function(e){h(this,z,e),Array.from(s(this,C).elements).forEach(t=>{t.name&&e[t.name]&&(t.value=e[t.name])})};var u,V,U,J,f,g,ot,kt,nt,Lt,G,gt,K,bt,w,P,at,St,rt,wt,ct,Dt,lt;class Rt extends Et{constructor(t){super([".button-customize",".edit-menu__form-action--cancel"],".edit-menu",{floatElement:".nav__btn--more-btn",hooks:{opened:()=>{s(this,J)?(h(this,U,new It(".edit-menu__form",{onSubmit:(i,o)=>{const n=O();if(!o)s(this,u).set(n,{...i,id:n,position:0,selected:!0,icon:"fallback"}),s(this,f,g).insertBefore(d(this,G,gt).call(this,s(this,u).get(n)),s(this,f,g).firstChild),d(this,K,bt).call(this),d(this,w,P).call(this);else{const{id:r,...l}=i,p=s(this,V).querySelector(`[data-id="${r}"]`);d(this,nt,Lt).call(this,p,{id:n,...l}),s(this,u).set(n,{id:n,...l}),s(this,u).delete(r),d(this,w,P).call(this)}}})),this.render(),Tt(s(this,f,g),()=>{h(this,u,new Map(Array.from(s(this,f,g).children).map((i,o)=>[i._data.id,{...s(this,u).get(i._data.id),position:o}]))),d(this,w,P).call(this)}),h(this,J,!1)):d(this,ot,kt).call(this),this.listeners.emit(E.OPENED)},closed:i=>{i.classList.contains("edit-menu__form-action--cancel")&&this.listeners.emit(E.CLOSED),s(this,U).clear()}}});c(this,f);c(this,ot);c(this,nt);c(this,G);c(this,K);c(this,w);c(this,at);c(this,rt);c(this,ct);W(this,"listeners",new _t);W(this,"provider",null);c(this,u,null);c(this,V,null);c(this,U,null);c(this,J,!0);c(this,lt,t=>{t.stopPropagation();const i=t.target.classList.contains("edit-popup__checkbox"),o=t.target.closest(".edit-menu__delete"),n=t.target.closest(".popup__section-item--clickable");if(i){d(this,at,St).call(this,t);return}if(o){d(this,rt,wt).call(this,t);return}n&&d(this,ct,Dt).call(this,n)});h(this,V,document.querySelector(".edit-menu")),this.provider=t,this.provider.on(E.RECEIVED,i=>{h(this,u,new Map(i.map(o=>[o.id,o])))}),document.addEventListener("click",s(this,lt))}render(){Array.from(s(this,u).values()).forEach(t=>{s(this,f,g).appendChild(d(this,G,gt).call(this,t))})}}u=new WeakMap,V=new WeakMap,U=new WeakMap,J=new WeakMap,f=new WeakSet,g=function(){return s(this,V).querySelector(".popup__section-list")},ot=new WeakSet,kt=function(){pt({container:s(this,f,g),elements:Array.from(s(this,f,g).children),sortFn:(t,i)=>{const o=t.querySelector("input"),n=i.querySelector("input"),r=o.dataset.id,l=n.dataset.id,p=s(this,u).get(r),N=s(this,u).get(l);return p&&(b(o,{attribute:"checked",value:p.selected}),b(t,{attribute:"data-position",value:p.position}),b(t,{attribute:"draggable",value:p.selected}),H(t,{className:"draggable",predicat:p.selected})),N&&(b(n,{attribute:"checked",value:N.selected}),b(i,{attribute:"data-position",value:N.position}),b(i,{attribute:"draggable",value:N.selected}),H(i,{className:"draggable",predicat:N.selected})),Number(t.dataset.position)-Number(i.dataset.position)}})},nt=new WeakSet,Lt=function(t,i){Object.assign(t._data,i);const[o,n]=t.querySelector(".popup__section-item--clickable").children;n.textContent=i.label,b(t,{attribute:"data-id",value:i.id}),b(o,{attribute:"style",value:ft(i.href)})},G=new WeakSet,gt=function(t){return new m("li",{data:t,classNames:["popup__section-item",{draggable:t.selected}],attrs:{draggable:t.selected,"data-position":t.position,"data-id":t.id},children:[new m("div",{classNames:["popup__action"],children:[new m("label",{classNames:["checkbox"],children:[new m("input",{classNames:["widget__checkbox","edit-popup__checkbox","visually-hidden"],attrs:{type:"checkbox",checked:t.selected,"data-id":t.id}}),new m("span")]}),new m("span",{classNames:["popup__section-item--clickable"],children:[new m("span",{classNames:["popup__icon",`popup__icon--${t.icon}`],attrs:{"aria-hidden":!0,style:ft(t.href)}}),new m("span",{classNames:["line-clamp-1"],children:[document.createTextNode(t.label)]})]}),new m("span",{classNames:["popup__icon","popup__icon--drag"],attrs:{"aria-hidden":!0}}),new m("button",{classNames:["edit-menu__delete"],children:[new m("span",{classNames:["popup__icon","popup__icon--delete"],attrs:{"aria-hidden":!0}})]})]})]}).element},K=new WeakSet,bt=function(){pt({container:s(this,f,g),elements:Array.from(s(this,f,g).children),eachFn:(t,i)=>{t.dataset.position=i,s(this,u).set(t._data.id,{...s(this,u).get(t._data.id),position:i})}})},w=new WeakSet,P=function(){this.provider.emit(E.UPDATE,Array.from(s(this,u).values()))},at=new WeakSet,St=function(t){const{id:i}=t.target.dataset,o={...s(this,u).get(i)};o.selected=!o.selected,b(t.target,{attribute:"checked",value:o.selected}),b(t.target.closest(".popup__section-item"),{attribute:"draggable",value:o.selected}),H(t.target.closest(".popup__section-item"),{className:"draggable",predicat:o.selected}),s(this,u).set(i,o);const n=t.target.closest("li");if(o.selected)n.dataset.position=0,n._data.position=0,s(this,f,g).insertBefore(n,s(this,f,g).firstChild);else{const r=s(this,f,g).children.length+1;n.dataset.position=r,n._data.position=r,s(this,f,g).appendChild(n)}d(this,K,bt).call(this),d(this,w,P).call(this)},rt=new WeakSet,wt=function(t){const{id:i}=t.target.closest(".popup__action").querySelector("input").dataset,o=t.target.closest("li");s(this,u).delete(i),o.remove(),d(this,w,P).call(this)},ct=new WeakSet,Dt=function(t){const{id:i}=t.closest("li").dataset;i&&s(this,u).has(i)&&s(this,U).fillForm(s(this,u).get(i))},lt=new WeakMap;const Bt=[{position:0,id:O(),selected:!0,icon:"wiki",href:"https://wikipedia.org",label:"Wikipedia"},{position:1,id:O(),selected:!0,icon:"youtube",href:"https://youtube.com",label:"YouTube"},{position:2,id:O(),selected:!0,icon:"bing",href:"https://bing.com",label:"Bing"},{position:3,id:O(),selected:!0,icon:"wolfram",href:"https://wolframalpha.com/",label:"WolframAlpha"},{position:4,id:O(),selected:!0,icon:"duckduckgo",href:"https://duckduckgo.com",label:"DuckDuckGo"}];function Mt(){const a=new Pt,e=new _t,t="engines",i=new qt(e),o=new Rt(e);o.listeners.on(E.OPENED,()=>{i.close()}),o.listeners.on(E.CLOSED,()=>{i.open()}),e.on(E.UPDATE,n=>{const r=n.sort((l,p)=>l.position-p.position);a.set({key:t,value:r}),e.emit(E.RECEIVED,r)}),e.on(E.CONNECT,()=>{console.info("Connect to LocalStorage...");const n=a.get({key:t}),r=(n!=null?n:Bt).sort((l,p)=>l.position-p.position);n===null&&(console.info("No data in LocalStorage, set default state..."),a.set({key:t,value:r})),e.emit(E.RECEIVED,r)}),e.emit(E.CONNECT)}window.addEventListener("DOMContentLoaded",Mt);
